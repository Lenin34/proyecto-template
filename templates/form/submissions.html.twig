{% extends 'base.html.twig' %}

{% set dominio = app.request.attributes.get('dominio') %}

{% block title %}Envíos del Formulario: {{ form_template.name }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('form-templates') }}
{% endblock %}

{% block body %}
    <section class="header-sntiasg-b form-header-enhanced py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <nav class="form-navigation mb-3">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">
                                <a href="{{ path('app_forms_index', {'dominio': dominio}) }}">
                                    <i class="fas fa-file-alt mr-1"></i> Formularios
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="{{ path('app_forms_show', {'id': form_template.id, 'dominio': dominio}) }}">
                                    {{ form_template.name }}
                                </a>
                            </li>
                            <li class="breadcrumb-item active">Envíos</li>
                        </ol>
                    </nav>
                    <h1><i class="fas fa-inbox mr-3"></i> Envíos del Formulario</h1>
                    <p class="subtitle">Revisa y gestiona todas las respuestas recibidas para "{{ form_template.name }}"</p>
                </div>
                <div class="col-md-4 text-md-end text-center mt-3 mt-md-0">
                    <div class="d-flex gap-2 justify-content-md-end justify-content-center">
                        <a href="{{ path('app_forms_show', {'id': form_template.id, 'dominio': dominio}) }}" class="btn-unified btn-nav-back">
                            <i class="fas fa-arrow-left"></i> Regresar
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container mt-4">
        <div class="card-dark">
            <div class="card-dark-header">
                <div class="card-dark-header-icon">
                    <i class="fas fa-list"></i>
                    <h5 class="card-title">Registros Recibidos</h5>
                </div>
            </div>
            <div class="card-dark-body p-0">
                {% if submissions|length > 0 %}
                    <div class="table-responsive">
                        <table class="table-dark-modern">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Usuario</th>
                                    <th>Enviado</th>
                                    <th>Estado</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for submission in submissions %}
                                    <tr>
                                        <td><span class="badge-dark badge-dark--info">#{{ submission.id }}</span></td>
                                        <td>
                                            {% if submission.user %}
                                                <i class="fas fa-user me-1 text-muted"></i>{{ submission.user.email }}
                                            {% else %}
                                                <span class="text-muted"><i class="fas fa-user-secret me-1"></i>Anónimo</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <i class="fas fa-calendar-alt me-1 text-muted"></i>{{ submission.createdAt|date('d/m/Y H:i') }}
                                        </td>
                                        <td>
                                            {% if submission.status.value == 'A' %}
                                                <span class="badge-dark badge-dark--success">
                                                    <i class="fas fa-check-circle me-1"></i>Activo
                                                </span>
                                            {% else %}
                                                <span class="badge-dark badge-dark--danger">
                                                    <i class="fas fa-times-circle me-1"></i>Inactivo
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            <div class="action-btn-group justify-content-center">
                                                <a href="{{ path('app_forms_submission_show', {'id': submission.id, 'dominio': dominio}) }}"
                                                   class="action-btn action-btn--view"
                                                   title="Ver envío">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="empty-state-dark">
                        <div class="empty-icon">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <h4>Sin envíos aún</h4>
                        <p>Este formulario no ha recibido ningún envío todavía.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}