{# Modal de Nuevo Administrador #}
<div class="modal fade" id="modalNew" tabindex="-1" aria-labelledby="modalNewLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-lg">
		<div class="modal-content modal-form">
			<div class="modal-header">
				<h5 class="modal-title" id="modalNewLabel">
					<i class="fas fa-user-shield me-2"></i>
					Nuevo Administrador
				</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				{{ form_start(form, {'attr': {'id': 'newAdminForm', 'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}
				<!-- BLOQUE 1: PERFIL Y CONTACTO -->
				<div class="row g-4 mb-4 align-items-center">
					<div class="col-md-3">
						<div class="file-upload-wrapper avatar-left">
							{{ form_widget(form.photo, {'attr': {'class': 'form-control d-none'}}) }}
							<div class="file-upload-display" id="newAdminPhotoDisplay">
								<div class="file-upload-icon">
									<i class="fas fa-camera"></i>
								</div>
								<div class="file-upload-text">
									<div class="upload-title">Foto</div>
									<div class="upload-subtitle">Máx. 5MB</div>
								</div>
								<img id="newAdminCurrentPhoto" src="" alt="Foto" class="position-absolute top-0 start-0 w-100 h-100 rounded-3" style="object-fit: cover; display: none;">
							</div>
						</div>
					</div>

					<div class="col-md-9">
						<div class="row g-3">
							<div class="col-md-6">
								<label class="form-label">Nombre *</label>
								{{ form_widget(form.name, {'attr': {'class': 'form-control form-control-dark', 'placeholder': 'Nombre'}}) }}
								<div class="text-danger small mt-1">{{ form_errors(form.name) }}</div>
							</div>
							<div class="col-md-6">
								<label class="form-label">Apellidos *</label>
								{{ form_widget(form.last_name, {'attr': {'class': 'form-control form-control-dark', 'placeholder': 'Apellidos'}}) }}
								<div class="text-danger small mt-1">{{ form_errors(form.last_name) }}</div>
							</div>
							<div class="col-md-6">
								<label class="form-label">Email *</label>
								{{ form_widget(form.email, {'attr': {'class': 'form-control form-control-dark', 'placeholder': 'ejemplo@correo.com'}}) }}
								<div class="text-danger small mt-1">{{ form_errors(form.email) }}</div>
							</div>
							<div class="col-md-6">
								<label class="form-label">Teléfono *</label>
								{{ form_widget(form.phone_number, {'attr': {'class': 'form-control form-control-dark', 'placeholder': '5512345678'}}) }}
								<div class="text-danger small mt-1">{{ form_errors(form.phone_number) }}</div>
							</div>
						</div>
					</div>
				</div>

				<hr class="my-4 opacity-25">

				<!-- BLOQUE 2: SEGURIDAD Y ACCESO -->
				<h6 class="mb-3 text-warning">
					<i class="fas fa-user-shield me-2"></i>Seguridad y Acceso
				</h6>
				<div class="row g-3">
					<div class="col-md-6">
						<label class="form-label">Contraseña *</label>
						{{ form_widget(form.password, {'attr': {'class': 'form-control form-control-dark', 'placeholder': '••••••••'}}) }}
						<div class="text-danger small mt-1">{{ form_errors(form.password) }}</div>
					</div>
					<div class="col-md-6">
						<label class="form-label">Rol *</label>
						{{ form_widget(form.role, {'attr': {'class': 'form-select form-control-dark'}}) }}
						<div class="text-danger small mt-1">{{ form_errors(form.role) }}</div>
					</div>
					<div class="col-md-6">
						<label class="form-label">Empresa</label>
						{{ form_widget(form.company, {'attr': {'class': 'form-select form-control-dark select2-new-company'}}) }}
						<div class="text-danger small mt-1">{{ form_errors(form.company) }}</div>
					</div>
					<div class="col-md-12">
						<label class="form-label">Regiones</label>
						{{ form_widget(form.regions, {'attr': {'class': 'form-select form-control-dark select2-new-regions'}}) }}
						<div class="text-danger small mt-1">{{ form_errors(form.regions) }}</div>
					</div>
				</div>
				{{ form_end(form) }}
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">
					<i class="fas fa-times me-2"></i>
					Cancelar
				</button>
				<button type="submit" form="newAdminForm" class="btn btn-success">
					<i class="fas fa-save me-2"></i>
					Guardar Administrador
				</button>
			</div>
		</div>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', function () {
// Initialize Select2 for new admin modal regions
// El ID del campo regions de Symfony será 'user_admin_regions'
$('#user_admin_regions').select2({
theme: 'bootstrap-5',
placeholder: 'Selecciona una o más regiones',
allowClear: true,
width: '100%',
closeOnSelect: false,
dropdownParent: $('#modalNew'),
templateResult: function (option) {
if (! option.id) 
return option.text;

return $('<span><i class="fas fa-map-marker-alt me-2"></i>' + option.text + '</span>');
},
templateSelection: function (option) {
if (! option.id) 
return option.text;

return $('<span><i class="fas fa-map-marker-alt me-1"></i>' + option.text + '</span>');
}
});

// Initialize Select2 for company
$('#user_admin_company').select2({
theme: 'bootstrap-5',
placeholder: 'Selecciona una empresa',
allowClear: true,
width: '100%',
dropdownParent: $('#modalNew'),
templateResult: function (option) {
if (! option.id) 
return option.text;

return $('<span><i class="fas fa-building me-2"></i>' + option.text + '</span>');
},
templateSelection: function (option) {
if (! option.id) 
return option.text;

return $('<span><i class="fas fa-building me-1"></i>' + option.text + '</span>');
}
});

// Photo Preview for new admin
// El ID del campo photo de Symfony será 'user_admin_photo'
const photoInput = document.getElementById('user_admin_photo');
const photoPreview = document.getElementById('newAdminCurrentPhoto');
const uploadText = document.querySelector('#newAdminPhotoDisplay .file-upload-text');
const uploadIcon = document.querySelector('#newAdminPhotoDisplay .file-upload-icon');

if (photoInput) {
photoInput.addEventListener('change', function (e) {
if (this.files && this.files[0]) {
const reader = new FileReader();
reader.onload = function (e) {
photoPreview.src = e.target.result;
photoPreview.style.display = 'block';
if (uploadText) 
uploadText.style.display = 'none';

if (uploadIcon) 
uploadIcon.style.display = 'none';

}
reader.readAsDataURL(this.files[0]);
}
});
}
});
</script>
